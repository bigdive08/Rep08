<html>
    <head>
        <script src='d3.v3.min.js'></script>
    </head>
    
    <body>
        <p>Peso Medio</p>
        
        <svg width = "1500" height = "200">
        
        </svg>
        
        <script>
        
            
            d3.csv('athletes_sochi.csv', function(data){
            
//                function MaleSum(arr){
//                    var somma = d3.sum(arr, function(d, i){
//                        return (d.gender == 'Male')? 1 : 0                        
//                    })
//                    return somma
//                }
                
                
                function height(arr){
                    var media = d3.mean(arr, function(d, i){
                        return d.height           
                    })
                    return media
                }
                
                function weight(arr){
                    var media = d3.mean(arr, function(d, i){
                        return (d.weight > 0) ? d.weight  : d.values.remove()          
                    })
                    return media
                }
                
                var newdata = d3.nest()
                    .key(function(d){
                    return d.sport
                }) 
                .rollup(function(d){
                    return{
                        height:height(d),
                        weight:weight(d)
                    }
                })
                //.sortKeys(d3.ascending)
                .entries(data)alm
                
                
                
    
                
                
            console.log(newdata)
           
            
             var MyCountryPlot = d3.select('svg')
                .selectAll('g')
                .data(newdata)
                .enter()
                .append('g')
                .attr('transform', function(d,i){
                    return 'translate(' + (i+.5) * 75 + ',0)'
                })
            
             var color = d3.scale.category20()
             
             MyCountryPlot.append('rect')
                .attr('width', 10)
                .attr('height', function(d,i){
                      return (d.values.weight) 
                })
                .attr('y', function(d,i){
                      return 90 - d.values.weight
                      
                })
                .attr('fill', function(d, i){
                    return color(i)
                })
         
             
              MyCountryPlot.append('text')
                .text(function(d,i){
                      return parseFloat(d.values.weight).toFixed(2)
                })
                .attr('y', function(d, i){
                    return 10 - d.values.weight
                })
                .attr('text-anchor','middle')
                .attr('font-size',8)
              
              
             MyCountryPlot.append('g')
                .attr('transform', 'translate(0, 130) rotate(-45)')
                .append('text')
                .text(function(d,i){
                     return d.key
                })
                .attr('text-anchor','middle')
                .attr('font-size',10)
            
//                .attr('transform', function(d,i){
//                    return 'translate(' + (i+1) * 75 + ',0)'
//                })

                          
//            MyCountryLabel.append('text')
//                
//                .attr('y',120)
               
                        
            
                
//             
//             MyCountryPlot.append('text')
//                .text(function(d,i){
//                     return d.values.male
//                })
//                .attr('x',15)
//                .attr('y', function(d, i){
//                    return 155 - d.values.male
//                })
//                .attr('text-anchor','middle')
//                .attr('font-size',8)
//             
//             
//             
//             
//             
//             
//             
//             
//            
           })
            
            
            
            
        
        </script>
    </body>
</html>
