<html>
    <head>
        <script src='d3.v3.min.js'></script>
    </head>
    
    <body>
        
        <svg width="1500" height="300"></svg>
        
        <script>
            
            d3.csv('athletes_sochi.csv', function(data){
            
                function MaleSum(arr){
                    var somma = d3.sum(arr, function(d, i){
                        return (d.gender == 'Male')? 1 : 0                        
                    })
                    return somma
                }
                
                function FemaleSum(arr){
                    var somma = d3.sum(arr, function(d, i){
                        return (d.gender == 'Female')? 1 : 0                        
                    })
                    return somma
                }
                
                var newdata = d3.nest()
                    .key(function(d){
                    return d.country
                }) 
                .rollup(function(d){
                    return{
                        male:MaleSum(d),
                        female:FemaleSum(d)
                    }
                })
                //.sortKeys(d3.ascending)
                .entries(data)
                
            console.log(newdata)
           
            
             var MyCountryPlot = d3.select('svg')
                .selectAll('g')
                .data(newdata)
                .enter()
                .append('g')
                .attr('transform', function(d,i){
                    return 'translate(' + (i+1) * 60 + ',0)'
                })
            
            
             MyCountryPlot.append('rect')
                .attr('width', 10)
                .attr('height', function(d,i){
                      return d.values.female
                })
                .attr('y', function(d,i){
                      return 160 - d.values.female
                })
                .attr('fill','pink')
             
             MyCountryPlot.append('rect')
                .attr('width', 10)
                .attr('height', function(d,i){
                      return d.values.male
                })
                .attr('x',11)
                .attr('y', function(d,i){
                      return 160 - d.values.male
                })
                .attr('fill','lightblue')
             
            
            MyCountryPlot.append('text')
                .text(function(d,i){
                     return d.key
                })
                .attr('y',10)
                .attr('text-anchor','middle')
                .attr('font-size',10)
            
            
             MyCountryPlot.append('text')
                .text(function(d,i){
                     return d.values.female
                })
                .attr('y', function(d, i){
                    return 150 - d.values.female
                })
                .attr('text-anchor','middle')
                .attr('font-size',8)
             
             MyCountryPlot.append('text')
                .text(function(d,i){
                     return d.values.male
                })
                .attr('x',15)
                .attr('y', function(d, i){
                    return 155 - d.values.male
                })
                .attr('text-anchor','middle')
                .attr('font-size',8)
             
             
             
             
             
             
             
             
            
            })
            
            
            
            
        
        </script>
    </body>
</html>
